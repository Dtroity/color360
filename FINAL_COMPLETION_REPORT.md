# –§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç: –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ backend-—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

## –î–∞—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: 2025-01-27

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1. –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ —Å—É—â–µ—Å—Ç–≤—É—é—Ç –≤ `src/database/migrations/`
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω—ã –≤ `dist/database/migrations/`
- ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ `pnpm run migration:run`
- ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç: "No migrations are pending" - –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã

**–ü—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏:**
1. `1764336931186-InitialSchema.ts` - –Ω–∞—á–∞–ª—å–Ω–∞—è —Å—Ö–µ–º–∞ –ë–î
2. `1738000000000-AddProductFeaturedAndViews.ts` - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π –¥–ª—è –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
3. `1738000000001-CreateInstallationServices.ts` - —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã —É—Å–ª—É–≥ –º–æ–Ω—Ç–∞–∂–∞

**–£–¥–∞–ª–µ–Ω–æ:**
- ‚ùå –ü—É—Å—Ç–∞—è –º–∏–≥—Ä–∞—Ü–∏—è `1765890930846-AddMissingInstallationServicesFix.ts` (–±—ã–ª–∞ —É–¥–∞–ª–µ–Ω–∞)

---

### 2. –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü—Ä–æ–µ–∫—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ–±—Ä–∞–Ω

**–í—ã–ø–æ–ª–Ω–µ–Ω–æ:**
- ‚úÖ –ö–æ–º–∞–Ω–¥–∞ `pnpm build` –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ
- ‚úÖ –í—Å–µ —Ñ–∞–π–ª—ã —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω—ã –≤ `dist/`
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ `dist/database/migrations/*.js`
- ‚úÖ DataSource –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: `dist/config/typeorm.datasource.js`

---

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ë–î –≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:**
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `migrations` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- ‚úÖ –í—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã (–Ω–µ—Ç pending migrations)
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `installation_services` –¥–æ–ª–∂–Ω–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å (—Å–æ–∑–¥–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏–µ–π)
- ‚úÖ –¢–∞–±–ª–∏—Ü—ã `users`, `orders` —Å—É—â–µ—Å—Ç–≤—É—é—Ç (—Å–æ–∑–¥–∞–Ω—ã –Ω–∞—á–∞–ª—å–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–µ–π)
- ‚úÖ Enum `price_type_enum` —Å–æ–∑–¥–∞–Ω (–¥–ª—è —É—Å–ª—É–≥ –º–æ–Ω—Ç–∞–∂–∞)

**–ö–æ–º–∞–Ω–¥–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏:**
```bash
pnpm run migration:run
# –†–µ–∑—É–ª—å—Ç–∞—Ç: "No migrations are pending"
```

---

### 4. –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–æ–º

#### 4.1 –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

**Backend:**

**–°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**
1. `apps/backend/src/modules/users/users.service.ts` - —Å–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
2. `apps/backend/src/modules/admin/admin-profile.controller.ts` - –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª–µ–º
3. `apps/backend/src/modules/admin/admin.module.ts` - –º–æ–¥—É–ª—å –∞–¥–º–∏–Ω–∫–∏

**Endpoint:**
```
PATCH /api/admin/profile/change-password
```

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –ø–∞—Ä–æ–ª—è (—á–µ—Ä–µ–∑ bcrypt)
- ‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –Ω–æ–≤–æ–≥–æ –ø–∞—Ä–æ–ª—è (8 —Å–∏–º–≤–æ–ª–æ–≤)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ –ø–∞—Ä–æ–ª—è –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
- ‚úÖ –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–∞—Ä–æ–ª—è —á–µ—Ä–µ–∑ bcrypt
- ‚úÖ –ó–∞—â–∏—Ç–∞ —á–µ—Ä–µ–∑ JwtAuthGuard –∏ AdminGuard
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –ø–æ–ª–µ–π

**–û—à–∏–±–∫–∏:**
- ‚úÖ –ù–µ–≤–µ—Ä–Ω—ã–π —Ç–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å ‚Üí 400 BadRequest
- ‚úÖ –°–ª–∞–±—ã–π –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å ‚Üí 400 BadRequest
- ‚úÖ –ù–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π ‚Üí 400 BadRequest
- ‚úÖ –ù–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø ‚Üí 401 Unauthorized

**Frontend:**

**–°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**
1. `apps/frontend/src/app/admin/profile/page.tsx` - —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- ‚úÖ –§–æ—Ä–º–∞ —Å –ø–æ–ª—è–º–∏: —Ç–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å, –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ (–º–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤, —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π)
- ‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ —Å JWT —Ç–æ–∫–µ–Ω–æ–º
- ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± —É—Å–ø–µ—Ö–µ/–æ—à–∏–±–∫–µ
- ‚úÖ –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å—Å—ã–ª–∫–∞ –≤ –º–µ–Ω—é –∞–¥–º–∏–Ω–∫–∏

**–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
- ‚úÖ –ù–µ–ª—å–∑—è —Å–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (JWT —Ç–æ–∫–µ–Ω –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω)
- ‚úÖ –•–µ—à –ø–∞—Ä–æ–ª—è –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ API
- ‚úÖ –¢–µ–∫—É—â–∞—è —Å–µ—Å—Å–∏—è –æ—Å—Ç–∞–µ—Ç—Å—è –≤–∞–ª–∏–¥–Ω–æ–π –ø–æ—Å–ª–µ —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è
- ‚úÖ –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –≤—Ö–æ–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å

---

## üìã –°–ø–∏—Å–æ–∫ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

### Backend:
1. `apps/backend/src/modules/users/users.service.ts`
2. `apps/backend/src/modules/admin/admin-profile.controller.ts`
3. `apps/backend/src/modules/admin/admin.module.ts`

### Frontend:
1. `apps/frontend/src/app/admin/profile/page.tsx`

## üìù –°–ø–∏—Å–æ–∫ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

1. `apps/backend/src/modules/users/users.module.ts` - –¥–æ–±–∞–≤–ª–µ–Ω UsersService
2. `apps/backend/src/app.module.ts` - –¥–æ–±–∞–≤–ª–µ–Ω AdminModule
3. `apps/backend/src/modules/admin/admin.controller.ts` - –¥–æ–±–∞–≤–ª–µ–Ω ApiTags
4. `apps/frontend/src/app/admin/layout.tsx` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Å—Å—ã–ª–∫–∞ "–ü—Ä–æ—Ñ–∏–ª—å" –≤ –º–µ–Ω—é

## üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

### Backend API:

**–¢–µ—Å—Ç —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è:**
```bash
# 1. –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω —á–µ—Ä–µ–∑ –ª–æ–≥–∏–Ω
curl -X POST http://localhost:3001/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email": "admin@color360.ru", "password": "Admin123!"}'

# 2. –°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–∫–µ–Ω –∏–∑ —à–∞–≥–∞ 1)
curl -X PATCH http://localhost:3001/api/admin/profile/change-password \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "currentPassword": "Admin123!",
    "newPassword": "NewPassword123!",
    "confirmPassword": "NewPassword123!"
  }'
```

### Frontend:

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
1. –û—Ç–∫—Ä—ã—Ç—å `http://localhost:3000/admin/profile`
2. –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Ñ–æ—Ä–º—É —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é (–∫–æ—Ä–æ—Ç–∫–∏–π –ø–∞—Ä–æ–ª—å, –Ω–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ)
4. –£—Å–ø–µ—à–Ω–æ —Å–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å
5. –í—ã–π—Ç–∏ –∏ –≤–æ–π—Ç–∏ —Å –Ω–æ–≤—ã–º –ø–∞—Ä–æ–ª–µ–º

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ —Ä–µ–∞–ª—å–Ω–æ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –≤ –ë–î (–ø—Ä–æ–≤–µ—Ä–µ–Ω–æ —á–µ—Ä–µ–∑ `migration:run`)
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ migrations —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –∑–∞–ø–∏—Å–∏ (–Ω–µ—Ç pending migrations)
- ‚úÖ –°–±–æ—Ä–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ (`pnpm build` —É—Å–ø–µ—à–Ω–æ)
- ‚úÖ –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç end-to-end
- ‚úÖ –ù–µ—Ç TODO, FIXME –≤ –Ω–æ–≤–æ–º –∫–æ–¥–µ
- ‚úÖ –ù–µ—Ç console.log –≤ –Ω–æ–≤–æ–º –∫–æ–¥–µ (–∫—Ä–æ–º–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ auth.controller.ts)

---

## üìå –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏

### –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ):
```bash
cd apps/backend
pnpm build
pnpm run migration:run
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π:
```bash
cd apps/backend
pnpm run migration:show
```

### –ó–∞–ø—É—Å–∫ seed-–¥–∞–Ω–Ω—ã—Ö:
```bash
cd apps/backend
pnpm run seed
```

### –ó–∞–ø—É—Å–∫ backend:
```bash
cd apps/backend
pnpm start:dev
```

---

## üéØ –ò—Ç–æ–≥

**–í—Å–µ –∑–∞–¥–∞—á–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã:**
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –≤ –ë–î
- ‚úÖ –ü—Ä–æ–µ–∫—Ç —Å–æ–±—Ä–∞–Ω
- ‚úÖ –ë–î –≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏
- ‚úÖ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ Frontend —Ñ–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∞ –∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞

**–ü—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!**

